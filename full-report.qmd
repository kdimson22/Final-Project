---
title: "PM 566 Final Project: Analysing Vaccine Preventable Diseases and Vaccine Hesitancy in California"
subtitle: University of Southern California, Fall 2024
author: "Kendall Dimson"
format: html
embed-resources: TRUE
---

## Introduction

Long since the rollout of the polio vaccine, there have been a variety of vaccines created in the 1900s to present-day that have been influential in the epidemiological shift, with vaccine efficiency as one of the main modes of primary prevention in infectious disease epidemiology. However, despite continuous efforts to vaccinate, many Vaccine-Preventable diseases are prevalent to this day that threaten the public health system. As a result, in the modern era there have been several vaccine-preventable epidemics that have occurred. According to the Center for Disease Control and Prevention, epidemics are defined as the occurrence of more cases of disease than expected in a given area or among a specific group of people over a particular period of time. There are various factors that can influence the occurrence of these epidemics, including vaccination rates and vaccine hesitancy. 

This project serves to conduct a comprehensive exploratory analysis into vaccine-preventable diseases in California. Various research questions include:
Where did the previous vaccine-preventable disease epidemics occur in California?
What is the normalized distribution in each county of Pertussis, also known as whooping cough?
Is there an association between patterns of vaccine hesitancy and vaccine-preventable disease incidence across counties?
Is there an association between patterns of childhood immunization rates and vaccine-preventable disease incidence across counties?



## Methods
The dataset, vaccine, was extracted through the California Health and Human Services Agency, with data collected from the California Department of Public Health.  The data includes the variables: ID, Disease (the disease reported), County (the location the disease was reported from), Year (the year that the disease was reported to CDPH), and count (the cumulative number of cases reported of a given disease in a given year, from the specific county). The dataset includes fifteen Disease categories:

Diphtheria, Invasive Meningococcal Disease, Measles, Pertussis, Tetanus, Mumps, Rubella, Hepatitis A, Acute Hepatitis B, Acute Hepatitis C, Varicella Hospitalizations, Varicella Hospitalization/Death, Chronic Hepatitis B, Haemophilus influenzae, Perinatal Hepatitis B, and Rubella (Congenital Syndrome).
	
To evaluate vaccine hesitancy in association to vaccine-preventable disease incidence, the dataset “Public Use Microdata Area with estimated COVID-19 vaccine hesitancies” was extracted from the Center of Disease Control and Prevention, based on the Health and Human Services’ Household Pulse Survey conducted from May 26 - June 7, 2021. The measure was based on the survey question, "Once a vaccine to prevent COVID-19 is available to you, would you…get a vaccine?” Options for the survey included:
 1) “definitely get a vaccine”
2) “probably get a vaccine”
3) “unsure”
4) “probably not get a vaccine”
5) “definitely not get a vaccine.” 

From there, the dataset measures the percentage of individuals in all U.S. counties that selected “probably not” and “definitely not,” defining vaccine hesitancy. The dataset also includes race/ethnicity percentage distribution in each Public Use Microdata Area. For this project’s analysis, the dataset is stratified to California counties. 

In the data cleaning and wrangling step, counties that recorded 0 cases of a disease were removed. Variety of subsetted datasets were created, subsetting into “california” and “county” datasets since there are some categories in the “County” variable that have a summation number of diseases in California. For each, the filter() function subset. The kable() function was used to print a table of the total number of vaccine preventable diseases reported in the entirety of the dataset. The arrange() function was used to print the top five vaccine-reportable diseases with highest cumulative incidence, as well as to print the top five counties of each disease. Ggplot barplots were used to visualize trends in incidence counts. To analyze the distribution of pertussis cases by counties, I used the leaflet package to code an interactive bubble map, normalized by population density. 

To visually analyze vaccine hesitancy association , leaflet heat maps were utilized.

## Results

```{r, echo=FALSE, message=FALSE, warning=FALSE}

#Set Up Code
options(repos = c(CRAN = "https://cran.rstudio.com/"))
install.packages("knitr")
install.packages("readr")

library(knitr)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(knitr)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)
vaccine <- read_csv("~/Desktop/a7a4d868-f6d2-49c9-8a11-904c69a0e3a0.csv")
county <- vaccine |> filter (County != 'California')
diseases_total <- county |> 
  group_by(Disease) |> 
  summarise(Total_Cases = sum(Count, na.rm = TRUE)) |> 
  arrange(desc(Total_Cases)) |> 
  slice_head(n = 15)

kable(diseases_total, 
      col.names = c("Disease", "Total Cases"), 
      caption = "Table 1. Total Cases of Vaccine-Preventable Diseases Reported in California, 2001-2022")
```

There were a total of 72,058 incident vaccine preventable cases recorded. The top five in total cases reported were Pertussis (n=57,219), Hepatitis B, chronic (n=4462) and acute (n=1349), Invasive Meningococcal Disease (n=2718), and Hepatitis A (n=3035).

## Conclusion and Summary





CODEEEEEE
```{r, echo=FALSE, message=FALSE, warning=FALSE}
hesitant <- read_csv("~/Desktop/Vaccine_Hesitancy_for_COVID-19__County_and_local_estimates_20241206.csv")

hesitant <- hesitant |> filter(State=='CALIFORNIA')

#Convert proportions to percentages
hesitant$`Estimated strongly hesitant`<- hesitant$`Estimated strongly hesitant` * 100

hesitant$`Estimated hesitant` <- hesitant$`Estimated hesitant` * 100

hesitant$`Estimated hesitant or unsure`<- hesitant$`Estimated hesitant or unsure` * 100

hesitant$`Percent adults fully vaccinated against COVID-19 (as of 6/10/21)` <- hesitant$`Percent adults fully vaccinated against COVID-19 (as of 6/10/21)` *100

hesitant$`Percent Hispanic`<- hesitant$`Percent Hispanic`*100

hesitant$`Percent non-Hispanic American Indian/Alaska Native`<- hesitant$`Percent non-Hispanic American Indian/Alaska Native`*100

hesitant$`Percent non-Hispanic White` <- hesitant$`Percent non-Hispanic White`*100

hesitant$`Percent non-Hispanic Asian`<- hesitant$`Percent non-Hispanic Asian`*100

hesitant$`Percent non-Hispanic Black` <- hesitant$`Percent non-Hispanic Black`*100

hesitant$`Percent non-Hispanic Native Hawaiian/Pacific Islander`<- hesitant$`Percent non-Hispanic Native Hawaiian/Pacific Islander`*100

hesitant_data <- hesitant %>%
  filter(State == 'CALIFORNIA') %>%
  select(
    `County Name`,
    `Percent Hispanic`,
    `Percent non-Hispanic American Indian/Alaska Native`,
    `Percent non-Hispanic White`,
    `Percent non-Hispanic Asian`,
    `Percent non-Hispanic Black`,
    `Percent non-Hispanic Native Hawaiian/Pacific Islander`,
    `Estimated strongly hesitant`,
    `Estimated hesitant`,
    `Estimated hesitant or unsure`,
    `Percent adults fully vaccinated against COVID-19 (as of 6/10/21)`
  ) %>%
  rename(
    County = `County Name`,
    Hispanic_Percentage = `Percent Hispanic`,
    Non_Hispanic_American_Indian_Alaska_Native = `Percent non-Hispanic American Indian/Alaska Native`,
    Non_Hispanic_White = `Percent non-Hispanic White`,
    Non_Hispanic_Asian = `Percent non-Hispanic Asian`,
    Non_Hispanic_Black = `Percent non-Hispanic Black`,
    Non_Hispanic_Native_Hawaiian_Pacific_Islander = `Percent non-Hispanic Native Hawaiian/Pacific Islander`,
    Strongly_Hesitant_Percentage = `Estimated strongly hesitant`,
    Hesitant_Percentage = `Estimated hesitant`,
    Hesitant_or_Unsure_Percentage = `Estimated hesitant or unsure`,
    Fully_Vaccinated_Percentage = `Percent adults fully vaccinated against COVID-19 (as of 6/10/21)`
  )
```

```{r}
# Graph 1: Top 10 Strongly Hesitant Counties (Horizontal Bar Graph)

top_10_strongly_hesitant <- hesitant |>
  arrange(desc(`Estimated strongly hesitant`)) |>
  head(10)

ggplot(top_10_strongly_hesitant, aes(x = `Estimated strongly hesitant`, 
                                     y = reorder(`County Name`, `Estimated strongly hesitant`), 
                                     fill = `County Name`)) +
  geom_bar(stat = "identity", show.legend = FALSE) + 
  geom_text(aes(label = round(`Estimated strongly hesitant`, 1)), 
            hjust = -0.1, size = 4) +  # Place labels inside bars
  labs(title = "Figure 1. Top 10 Strongly Hesitant Counties - Vaccine Hesitancy",
       x = "Strongly Hesitant Percentage (%)",
       y = "County") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10), 
        plot.title = element_text(hjust = 0.5)) 


# Graph 2: Top 10 Hesitant Counties (Horizontal Bar Graph)

top_10_hesitant <- hesitant %>%
  arrange(desc(`Estimated hesitant`)) %>%
  head(10)

ggplot(top_10_hesitant, aes(x = `Estimated hesitant`, 
                            y = reorder(`County Name`, `Estimated hesitant`), 
                            fill = `County Name`)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  geom_text(aes(label = round(`Estimated hesitant`, 1)), 
            hjust = -0.1, size = 4) +  
  labs(title = "Figure 2. Top 10 Hesitant Counties - Vaccine Hesitancy",
       x = "Hesitant Percentage (%)",
       y = "County") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10), 
        axis.text.x = element_text(size = 10),  
        plot.title = element_text(hjust = 0.5)) 


# Graph 3: Top 10 Hesitant or Unsure Counties (Horizontal Bar Graph)

top_10_hesitant_unsure <- hesitant|>
  arrange(desc(`Estimated hesitant or unsure`)) |>
  head(10)

ggplot(top_10_hesitant_unsure, aes(x = `Estimated hesitant or unsure`, 
                                   y = reorder(`County Name`, `Estimated hesitant or unsure`),
                                   fill = `County Name`)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  geom_text(aes(label = round(`Estimated hesitant or unsure`, 1)), 
            hjust = -0.1, size = 4) +  
  labs(title = "Figure 3. Top 10 Hesitant or Unsure Counties - Vaccine Hesitancy",
       x = "Hesitant or Unsure Percentage (%)",
       y = "County") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10),  # Adjust y-axis text size
        axis.text.x = element_text(size = 10),  # Adjust x-axis text size
        plot.title = element_text(hjust = 0.5))  # Center title

```

```{r}


#packages
install.packages("leaflet.extras")
library(leaflet.extras)
library(leaflet)
library(dplyr)

county_coordinates <- data.frame(
  County = c(
    "Alameda", 
    "Alpine", 
    "Amador", 
    "Butte", 
    "Calaveras", 
    "Colusa", 
    "Contra Costa", 
    "Del Norte", 
    "El Dorado", 
    "Fresno", 
    "Glenn", 
    "Humboldt", 
    "Imperial", 
    "Inyo", 
    "Kern", 
    "Kings", 
    "Lake", 
    "Lassen", 
    "Los Angeles", 
    "Marin", 
    "Mariposa", 
    "Mendocino", 
    "Merced", 
    "Modoc", 
    "Mono", 
    "Monterey", 
    "Napa", 
    "Nevada", 
    "Orange", 
    "Placer", 
    "Plumas", 
    "Riverside", 
    "Sacramento", 
    "San Benito", 
    "San Bernardino", 
    "San Diego", 
    "San Francisco", 
    "San Joaquin", 
    "San Luis Obispo", 
    "San Mateo", 
    "Santa Barbara", 
    "Santa Clara", 
    "Santa Cruz", 
    "Shasta", 
    "Sierra", 
    "Siskiyou", 
    "Solano", 
    "Sonoma", 
    "Stanislaus", 
    "Sutter", 
    "Tehama", 
    "Trinity", 
    "Tulare", 
    "Tuolumne", 
    "Ventura", 
    "Yolo", 
    "Yuba"
  ),
  lat = c(
    37.6010,  # Alameda
    38.3652,  # Alpine
    38.3970,  # Amador
    39.4739,  # Butte
    38.2009,  # Calaveras
    39.2068,  # Colusa
    38.0016,  # Contra Costa
    41.7469,  # Del Norte
    38.7420,  # El Dorado
    36.7470,  # Fresno
    39.5051,  # Glenn
    40.6765,  # Humboldt
    32.6654,  # Imperial
    36.5784,  # Inyo
    35.4875,  # Kern
    36.0945,  # Kings
    38.9682,  # Lake
    40.5832,  # Lassen
    34.0522,  # Los Angeles
    38.0449,  # Marin
    37.4875,  # Mariposa
    39.4502,  # Mendocino
    37.3020,  # Merced
    41.5572,  # Modoc
    37.9500,  # Mono
    36.6777,  # Monterey
    38.2975,  # Napa
    39.2199,  # Nevada
    33.7175,  # Orange
    39.0910,  # Placer
    39.9724,  # Plumas
    33.9533,  # Riverside
    38.5816,  # Sacramento
    36.5772,  # San Benito
    34.1083,  # San Bernardino
    32.7157,  # San Diego
    37.7749,  # San Francisco
    37.9563,  # San Joaquin
    35.3733,  # San Luis Obispo
    37.5631,  # San Mateo
    34.4208,  # Santa Barbara
    37.3541,  # Santa Clara
    36.9741,  # Santa Cruz
    40.7906,  # Shasta
    39.5272,  # Sierra
    41.4936,  # Siskiyou
    38.2494,  # Solano
    38.5004,  # Sonoma
    37.4959,  # Stanislaus
    39.0194,  # Sutter
    40.0982,  # Tehama
    40.6542,  # Trinity
    36.1400,  # Tulare
    38.0291,  # Tuolumne
    34.3705,  # Ventura
    38.7647,  # Yolo
    39.1345   # Yuba
  ),
  lon = c(
    -122.2727,  # Alameda
    -119.8489,  # Alpine
    -120.6080,  # Amador
    -121.8076,  # Butte
    -120.5606,  # Calaveras
    -122.0015,  # Colusa
    -121.8058,  # Contra Costa
    -124.1018,  # Del Norte
    -120.5351,  # El Dorado
    -119.7724,  # Fresno
    -122.1740,  # Glenn
    -124.1958,  # Humboldt
    -115.3746,  # Imperial
    -116.2028,  # Inyo
    -118.8597,  # Kern
    -119.8817,  # Kings
    -122.8008,  # Lake
    -120.6548,  # Lassen
    -118.2437,  # Los Angeles
    -122.5156,  # Marin
    -119.9309,  # Mariposa
    -123.8060,  # Mendocino
    -120.4844,  # Merced
    -120.5420,  # Modoc
    -118.9560,  # Mono
    -121.6555,  # Monterey
    -122.2869,  # Napa
    -120.5734,  # Nevada
    -117.8310,  # Orange
    -120.8055,  # Placer
    -120.4841,  # Plumas
    -117.3962,  # Riverside
    -121.4944,  # Sacramento
    -121.5025,  # San Benito
    -116.5810,  # San Bernardino
    -117.1611,  # San Diego
    -122.4194,  # San Francisco
    -121.3134,  # San Joaquin
    -120.6544,  # San Luis Obispo
    -122.3710,  # San Mateo
    -119.6982,  # Santa Barbara
    -121.9552,  # Santa Clara
    -121.9552,  # Santa Cruz
    -122.4640,  # Shasta
    -119.5890,  # Sierra
    -122.4540,  # Siskiyou
    -122.0364,  # Solano
    -122.4064,  # Sonoma
    -120.8450,  # Stanislaus
    -121.6656,  # Sutter
    -122.4300,  # Tehama
    -123.1382,  # Trinity
    -118.8597,  # Tulare
    -120.2370,  # Tuolumne
    -119.1396,  # Ventura
    -121.9018,  # Yolo
    -121.5885   # Yuba
  )
)

hesitant <- hesitant |> rename (County = `County Name`)

heatmap_data_hesitancy <- hesitant|>
  left_join(county_coordinates, by = "County")

# Create the leaflet map with the heatmap using the percentage values
map <- leaflet(heatmap_data_hesitancy) |>
  addProviderTiles("CartoDB.Positron") |>
  addHeatmap(
    lng = ~lon,
    lat = ~lat,
    intensity = ~`Estimated hesitant`,
    blur = 2, 
    max = 20,
    radius = 15
  ) |>   setView(lng = -119.4179, lat = 36.7783, zoom = 6) # Centers map over California

map


```
head(heatmap_data_hesitancy)
summary(heatmap_data_hesitancy$`Estimated hesitant`)

stuf

```{r}
# Test with a known example of leaflet heatmap
library(leaflet)
library(leaflet.extras)

# Example data with latitude, longitude, and intensity
data <- data.frame(
  lat = c(37.7749, 37.7849, 37.7949, 37.8049),
  lon = c(-122.4194, -122.4094, -122.3994, -122.3894),
  intensity = c(1, 10, 50, 100)
)

# Create a simple leaflet map with a heatmap
map <- leaflet(data) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addHeatmap(
    lng = ~lon,
    lat = ~lat,
    intensity = ~intensity, # intensity values
    blur = 20,
    max = 100,
    radius = 15
  ) %>%
  setView(lng = -122.4194, lat = 37.7749, zoom = 13)  # Zoom to San Francisco

# Render the map
map


```



```{r}

## Appendix: Code Used for Project
#This section includes is all of the code I created in data cleaning and data wrangling to compile my report.

#Set Up Code
options(repos = c(CRAN = "https://cran.rstudio.com/"))
install.packages("knitr")
install.packages("readr")

library(knitr)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)

vaccine <- read_csv("~/Desktop/a7a4d868-f6d2-49c9-8a11-904c69a0e3a0.csv")

#Variables: ID, Disease, County, Year, Count

```

```{r}

# EDA

#Remove counties that reported 0 cases in a year
vaccine <- vaccine |> filter(Count != 0)

#Check count of disease categories in the dataset
vaccine |>
  count(Disease, sort=TRUE)

#Checked for any missing values or irregularities
#summary(vaccine)

#Total number of cases in dataset, stratify by counties, states overall, and top 5 diseases
county <- vaccine |> filter (County != 'California')
california <- vaccine |> filter (County == 'California')

#summations, each year
#table(vaccine$Year)
#sum(county$Count)

dim(county)
head(county)
tail(county)
str(county)
summary(county)
#No issues found in data irregularities. Year and Count variables numeric. Disease & County variables are character class. _id variable is irrelevant in this analysis.

```

```{r}
#Print Nice Table of Statistics

diseases_total <- county |> 
 group_by(Disease) |> 
 summarise(Total_Cases = sum(Count, na.rm = TRUE)) |> 
 arrange(desc(Total_Cases)) |> 
 slice_head(n = 15)
library (knitr)
kable(diseases_total, 
      col.names = c("Disease", "Total Cases"), 
     caption = "Total Cases of Vaccine-Preventable Diseases Reported in California, 2001-2022")

```

```{r}
#Preliminary Analysis #1: Of the top five vaccine preventable disease cases reported in California in the last decades, were there any signs of epidemics in specific counties?

# Group by Disease and summarize the total cases
top_diseases <- county |> 
  group_by(Disease) |> 
  summarise(Total_Cases = sum(Count, na.rm = TRUE)) |> 
  arrange(desc(Total_Cases)) |> 
  slice_head(n = 5)

top_diseases

#Top 5, create individual datasets
pertussis <- county |> filter (Disease == 'Pertussis')
hbv_chronic <- county |> filter (Disease == 'Hepatitis B, Chronic')
hav <- county |> filter (Disease == 'Hepatitis A')
IMD <- county |> filter (Disease == 'Invasive Meningococcal Disease')
hbv_acute <- county |> filter (Disease == 'Hepatitis B, Acute')

#Top 5 Counties with Recorded Pertussis
pertussis |> arrange(desc(Count)) |> slice_head(n=5)

  #Stratify Pertussis, Check Los Angeles Trend
pertussis_la <- pertussis |> 
  filter(County == 'Los Angeles')

ggplot(pertussis_la, aes(x = Year, y = Count)) +
  geom_bar(stat = "identity", fill = "blue") +
  labs(title = "Figure 1: Pertussis Cases in Los Angeles County, by Year",
       x = "Year",
       y = "Number of Cases") +
  scale_x_continuous(breaks = seq(min(pertussis_la$Year), max(pertussis_la$Year), by = 1)) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

#Top 5 Counties with Recorded Chronic HBV
hbv_chronic |> arrange(desc(Count)) |> slice_head(n=5)

#Top 5 Counties with Recorded Hepatitis A
hav |> arrange(desc(Count)) |> slice_head(n=5)

  #Stratify HAV, Check San Diego Trend
hav_sd <- hav |> 
  filter(County == 'San Diego')

ggplot(hav_sd, aes(x = Year, y = Count)) +
  geom_bar(stat = "identity", fill = "red") +
  labs(title = "Figure 2: Hepatitis A Cases in San Diego County, by Year",
       x = "Year",
       y = "Number of Cases") + 
  scale_x_continuous(breaks = seq(min(hav_sd$Year), max(hav_sd$Year), by = 1)) +
  theme_minimal() 

#Top 5 Counties with Recorded IMD
IMD |> arrange(desc(Count)) |> slice_head(n=5)

  #Stratify IMD, Check LA Trend
IMD_la <- IMD |> 
  filter(County == 'Los Angeles')

ggplot(IMD_la, aes(x = Year, y = Count)) +
  geom_bar(stat = "identity", fill = "darkgreen") +
  labs(title = "Figure 3: Invasive Menginococcal Cases in Los Angeles County, by Year",
       x = "Year",
       y = "Number of Cases") +
  theme_minimal() 

#Top 5 Counties with Recorded acute hep b
hbv_acute |> arrange(desc(Count)) |> slice_head(n=5)

  #Stratify acute HBV, Check LA Trend
hbv_la <- hbv_acute |> 
  filter(County == 'Los Angeles')

ggplot(hbv_la, aes(x = Year, y = Count)) +
  geom_bar(stat = "identity", fill = "plum") +
  labs(title = "Figure 4: Acute Hepatitis B in Los Angeles County, by Year",
       x = "Year",
       y = "Number of Cases") +
    scale_x_continuous(breaks = seq(min(hav_sd$Year), max(hav_sd$Year), by = 1)) +
  theme_minimal() 


```

```{r}
library (leaflet)
pertussis_tot <- pertussis |> group_by(County)|>
  summarise(Total_Cases =sum(Count, na.rm=TRUE)) |>
  ungroup()

county_coordinates <- data.frame(
  County = c(
    "Alameda", 
    "Alpine", 
    "Amador", 
    "Butte", 
    "Calaveras", 
    "Colusa", 
    "Contra Costa", 
    "Del Norte", 
    "El Dorado", 
    "Fresno", 
    "Glenn", 
    "Humboldt", 
    "Imperial", 
    "Inyo", 
    "Kern", 
    "Kings", 
    "Lake", 
    "Lassen", 
    "Los Angeles", 
    "Marin", 
    "Mariposa", 
    "Mendocino", 
    "Merced", 
    "Modoc", 
    "Mono", 
    "Monterey", 
    "Napa", 
    "Nevada", 
    "Orange", 
    "Placer", 
    "Plumas", 
    "Riverside", 
    "Sacramento", 
    "San Benito", 
    "San Bernardino", 
    "San Diego", 
    "San Francisco", 
    "San Joaquin", 
    "San Luis Obispo", 
    "San Mateo", 
    "Santa Barbara", 
    "Santa Clara", 
    "Santa Cruz", 
    "Shasta", 
    "Sierra", 
    "Siskiyou", 
    "Solano", 
    "Sonoma", 
    "Stanislaus", 
    "Sutter", 
    "Tehama", 
    "Trinity", 
    "Tulare", 
    "Tuolumne", 
    "Ventura", 
    "Yolo", 
    "Yuba"
  ),
  lat = c(
    37.6010,  # Alameda
    38.3652,  # Alpine
    38.3970,  # Amador
    39.4739,  # Butte
    38.2009,  # Calaveras
    39.2068,  # Colusa
    38.0016,  # Contra Costa
    41.7469,  # Del Norte
    38.7420,  # El Dorado
    36.7470,  # Fresno
    39.5051,  # Glenn
    40.6765,  # Humboldt
    32.6654,  # Imperial
    36.5784,  # Inyo
    35.4875,  # Kern
    36.0945,  # Kings
    38.9682,  # Lake
    40.5832,  # Lassen
    34.0522,  # Los Angeles
    38.0449,  # Marin
    37.4875,  # Mariposa
    39.4502,  # Mendocino
    37.3020,  # Merced
    41.5572,  # Modoc
    37.9500,  # Mono
    36.6777,  # Monterey
    38.2975,  # Napa
    39.2199,  # Nevada
    33.7175,  # Orange
    39.0910,  # Placer
    39.9724,  # Plumas
    33.9533,  # Riverside
    38.5816,  # Sacramento
    36.5772,  # San Benito
    34.1083,  # San Bernardino
    32.7157,  # San Diego
    37.7749,  # San Francisco
    37.9563,  # San Joaquin
    35.3733,  # San Luis Obispo
    37.5631,  # San Mateo
    34.4208,  # Santa Barbara
    37.3541,  # Santa Clara
    36.9741,  # Santa Cruz
    40.7906,  # Shasta
    39.5272,  # Sierra
    41.4936,  # Siskiyou
    38.2494,  # Solano
    38.5004,  # Sonoma
    37.4959,  # Stanislaus
    39.0194,  # Sutter
    40.0982,  # Tehama
    40.6542,  # Trinity
    36.1400,  # Tulare
    38.0291,  # Tuolumne
    34.3705,  # Ventura
    38.7647,  # Yolo
    39.1345   # Yuba
  ),
  lon = c(
    -122.2727,  # Alameda
    -119.8489,  # Alpine
    -120.6080,  # Amador
    -121.8076,  # Butte
    -120.5606,  # Calaveras
    -122.0015,  # Colusa
    -121.8058,  # Contra Costa
    -124.1018,  # Del Norte
    -120.5351,  # El Dorado
    -119.7724,  # Fresno
    -122.1740,  # Glenn
    -124.1958,  # Humboldt
    -115.3746,  # Imperial
    -116.2028,  # Inyo
    -118.8597,  # Kern
    -119.8817,  # Kings
    -122.8008,  # Lake
    -120.6548,  # Lassen
    -118.2437,  # Los Angeles
    -122.5156,  # Marin
    -119.9309,  # Mariposa
    -123.8060,  # Mendocino
    -120.4844,  # Merced
    -120.5420,  # Modoc
    -118.9560,  # Mono
    -121.6555,  # Monterey
    -122.2869,  # Napa
    -120.5734,  # Nevada
    -117.8310,  # Orange
    -120.8055,  # Placer
    -120.4841,  # Plumas
    -117.3962,  # Riverside
    -121.4944,  # Sacramento
    -121.5025,  # San Benito
    -116.5810,  # San Bernardino
    -117.1611,  # San Diego
    -122.4194,  # San Francisco
    -121.3134,  # San Joaquin
    -120.6544,  # San Luis Obispo
    -122.3710,  # San Mateo
    -119.6982,  # Santa Barbara
    -121.9552,  # Santa Clara
    -121.9552,  # Santa Cruz
    -122.4640,  # Shasta
    -119.5890,  # Sierra
    -122.4540,  # Siskiyou
    -122.0364,  # Solano
    -122.4064,  # Sonoma
    -120.8450,  # Stanislaus
    -121.6656,  # Sutter
    -122.4300,  # Tehama
    -123.1382,  # Trinity
    -118.8597,  # Tulare
    -120.2370,  # Tuolumne
    -119.1396,  # Ventura
    -121.9018,  # Yolo
    -121.5885   # Yuba
  )
)


heatmap_data <- pertussis_tot|>
  left_join(county_coordinates, by = "County")

leaflet(heatmap_data) |>
  addTiles() |>
  addCircleMarkers(
    lng = ~lon,
    lat = ~lat,
    weight = 1,
    radius = ~sqrt(Total_Cases) * 0.5,
    color = "green",
    fillOpacity = 0.5,
    popup = ~paste(County, ": ", Total_Cases, " cases")
  ) |>
  setView(lng = -119.4179, lat = 36.7783, zoom = 6)
```