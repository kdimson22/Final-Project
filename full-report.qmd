---
title: "PM 566 Final Project: Analysing Vaccine Preventable Diseases and Vaccine Hesitancy in California"
subtitle: University of Southern California, Fall 2024
author: "Kendall Dimson"
format: html
embed-resources: TRUE
---

## Introduction

Long since the rollout of the polio vaccine, there have been a variety of vaccines created in the 1900s to present-day that have been influential in the epidemiological shift, with vaccine efficiency as one of the main modes of primary prevention in infectious disease epidemiology. However, despite continuous efforts to vaccinate, many Vaccine-Preventable diseases are prevalent to this day that threaten the public health system. As a result, in the modern era there have been several vaccine-preventable epidemics that have occurred. According to the Center for Disease Control and Prevention, epidemics are defined as the occurrence of more cases of disease than expected in a given area or among a specific group of people over a particular period of time. There are various factors that can influence the occurrence of these epidemics, including vaccination rates and vaccine hesitancy. 

This project serves to conduct a comprehensive exploratory analysis into vaccine-preventable diseases in California. Various research questions include:
Where did the previous vaccine-preventable disease epidemics occur in California?
What is the normalized distribution in each county of Pertussis, also known as whooping cough?
Is there an association between patterns of vaccine hesitancy and vaccine-preventable disease incidence across counties?
Is there an association between patterns of childhood immunization rates and vaccine-preventable disease incidence across counties?



## Methods
The dataset, vaccine, was extracted through the California Health and Human Services Agency, with data collected from the California Department of Public Health.  The data includes the variables: ID, Disease (the disease reported), County (the location the disease was reported from), Year (the year that the disease was reported to CDPH), and count (the cumulative number of cases reported of a given disease in a given year, from the specific county). The dataset includes fifteen Disease categories:

Diphtheria, Invasive Meningococcal Disease, Measles, Pertussis, Tetanus, Mumps, Rubella, Hepatitis A, Acute Hepatitis B, Acute Hepatitis C, Varicella Hospitalizations, Varicella Hospitalization/Death, Chronic Hepatitis B, Haemophilus influenzae, Perinatal Hepatitis B, and Rubella (Congenital Syndrome).
	
To evaluate vaccine hesitancy in association to vaccine-preventable disease incidence, the dataset “Public Use Microdata Area with estimated COVID-19 vaccine hesitancies” was extracted from the Center of Disease Control and Prevention, based on the Health and Human Services’ Household Pulse Survey conducted from May 26 - June 7, 2021. The measure was based on the survey question, "Once a vaccine to prevent COVID-19 is available to you, would you…get a vaccine?” Options for the survey included:
 1) “definitely get a vaccine”
2) “probably get a vaccine”
3) “unsure”
4) “probably not get a vaccine”
5) “definitely not get a vaccine.” 

From there, the dataset measures the percentage of individuals in all U.S. counties that selected “probably not” and “definitely not,” defining vaccine hesitancy. The dataset also includes race/ethnicity percentage distribution in each Public Use Microdata Area. For this project’s analysis, the dataset is stratified to California counties. 

In the data cleaning and wrangling step, counties that recorded 0 cases of a disease were removed. Variety of subsetted datasets were created, subsetting into “california” and “county” datasets since there are some categories in the “County” variable that have a summation number of diseases in California. For each, the filter() function subset. The kable() function was used to print a table of the total number of vaccine preventable diseases reported in the entirety of the dataset. The arrange() function was used to print the top five vaccine-reportable diseases with highest cumulative incidence, as well as to print the top five counties of each disease. Ggplot barplots were used to visualize trends in incidence counts. To analyze the distribution of pertussis cases by counties, I used the leaflet package to code an interactive bubble map, normalized by population density. 

To visually analyze vaccine hesitancy association , leaflet heat maps were utilized.

## Results

```{r, echo=FALSE, message=FALSE, warning=FALSE}

#Set Up Code
options(repos = c(CRAN = "https://cran.rstudio.com/"))
install.packages("knitr")
install.packages("readr")

library(knitr)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(knitr)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)
vaccine <- read_csv("~/Desktop/a7a4d868-f6d2-49c9-8a11-904c69a0e3a0.csv")
county <- vaccine |> filter (County != 'California')
diseases_total <- county |> 
  group_by(Disease) |> 
  summarise(Total_Cases = sum(Count, na.rm = TRUE)) |> 
  arrange(desc(Total_Cases)) |> 
  slice_head(n = 15)

kable(diseases_total, 
      col.names = c("Disease", "Total Cases"), 
      caption = "Table 1. Total Cases of Vaccine-Preventable Diseases Reported in California, 2001-2022")
```

There were a total of 72,058 incident vaccine preventable cases recorded. The top five in total cases reported were Pertussis (n=57,219), Hepatitis B, chronic (n=4462) and acute (n=1349), Invasive Meningococcal Disease (n=2718), and Hepatitis A (n=3035).

## Conclusion and Summary





CODEEEEEE
```{r, echo=FALSE, message=FALSE, warning=FALSE}
hesitant <- read_csv("~/Desktop/Vaccine_Hesitancy_for_COVID-19__County_and_local_estimates_20241206.csv")

hesitant <- hesitant |> filter(State=='CALIFORNIA')

#Convert proportions to percentages
hesitant$`Estimated strongly hesitant`<- hesitant$`Estimated strongly hesitant` * 100

hesitant$`Estimated hesitant` <- hesitant$`Estimated hesitant` * 100

hesitant$`Estimated hesitant or unsure`<- hesitant$`Estimated hesitant or unsure` * 100

hesitant$`Percent adults fully vaccinated against COVID-19 (as of 6/10/21)` <- hesitant$`Percent adults fully vaccinated against COVID-19 (as of 6/10/21)` *100

hesitant$`Percent Hispanic`<- hesitant$`Percent Hispanic`*100

hesitant$`Percent non-Hispanic American Indian/Alaska Native`<- hesitant$`Percent non-Hispanic American Indian/Alaska Native`*100

hesitant$`Percent non-Hispanic White` <- hesitant$`Percent non-Hispanic White`*100

hesitant$`Percent non-Hispanic Asian`<- hesitant$`Percent non-Hispanic Asian`*100

hesitant$`Percent non-Hispanic Black` <- hesitant$`Percent non-Hispanic Black`*100

hesitant$`Percent non-Hispanic Native Hawaiian/Pacific Islander`<- hesitant$`Percent non-Hispanic Native Hawaiian/Pacific Islander`*100

hesitant_data <- hesitant %>%
  filter(State == 'CALIFORNIA') %>%
  select(
    `County Name`,
    `Percent Hispanic`,
    `Percent non-Hispanic American Indian/Alaska Native`,
    `Percent non-Hispanic White`,
    `Percent non-Hispanic Asian`,
    `Percent non-Hispanic Black`,
    `Percent non-Hispanic Native Hawaiian/Pacific Islander`,
    `Estimated strongly hesitant`,
    `Estimated hesitant`,
    `Estimated hesitant or unsure`,
    `Percent adults fully vaccinated against COVID-19 (as of 6/10/21)`
  ) %>%
  rename(
    County = `County Name`,
    Hispanic_Percentage = `Percent Hispanic`,
    Non_Hispanic_American_Indian_Alaska_Native = `Percent non-Hispanic American Indian/Alaska Native`,
    Non_Hispanic_White = `Percent non-Hispanic White`,
    Non_Hispanic_Asian = `Percent non-Hispanic Asian`,
    Non_Hispanic_Black = `Percent non-Hispanic Black`,
    Non_Hispanic_Native_Hawaiian_Pacific_Islander = `Percent non-Hispanic Native Hawaiian/Pacific Islander`,
    Strongly_Hesitant_Percentage = `Estimated strongly hesitant`,
    Hesitant_Percentage = `Estimated hesitant`,
    Hesitant_or_Unsure_Percentage = `Estimated hesitant or unsure`,
    Fully_Vaccinated_Percentage = `Percent adults fully vaccinated against COVID-19 (as of 6/10/21)`
  )
```

```{r}
# Graph 1: Top 10 Strongly Hesitant Counties (Horizontal Bar Graph)

top_10_strongly_hesitant <- hesitant |>
  arrange(desc(`Estimated strongly hesitant`)) |>
  head(10)

ggplot(top_10_strongly_hesitant, aes(x = `Estimated strongly hesitant`, 
                                     y = reorder(`County Name`, `Estimated strongly hesitant`), 
                                     fill = `County Name`)) +
  geom_bar(stat = "identity", show.legend = FALSE) + 
  geom_text(aes(label = round(`Estimated strongly hesitant`, 1)), 
            hjust = -0.1, size = 4) +  # Place labels inside bars
  labs(title = "Figure 1. Top 10 Strongly Hesitant Counties - Vaccine Hesitancy",
       x = "Strongly Hesitant Percentage (%)",
       y = "County") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10), 
        plot.title = element_text(hjust = 0.5)) 


# Graph 2: Top 10 Hesitant Counties (Horizontal Bar Graph)

top_10_hesitant <- hesitant %>%
  arrange(desc(`Estimated hesitant`)) %>%
  head(10)

ggplot(top_10_hesitant, aes(x = `Estimated hesitant`, 
                            y = reorder(`County Name`, `Estimated hesitant`), 
                            fill = `County Name`)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  geom_text(aes(label = round(`Estimated hesitant`, 1)), 
            hjust = -0.1, size = 4) +  
  labs(title = "Figure 2. Top 10 Hesitant Counties - Vaccine Hesitancy",
       x = "Hesitant Percentage (%)",
       y = "County") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10), 
        axis.text.x = element_text(size = 10),  
        plot.title = element_text(hjust = 0.5)) 


# Graph 3: Top 10 Hesitant or Unsure Counties (Horizontal Bar Graph)

top_10_hesitant_unsure <- hesitant|>
  arrange(desc(`Estimated hesitant or unsure`)) |>
  head(10)

ggplot(top_10_hesitant_unsure, aes(x = `Estimated hesitant or unsure`, 
                                   y = reorder(`County Name`, `Estimated hesitant or unsure`),
                                   fill = `County Name`)) +
  geom_bar(stat = "identity", show.legend = FALSE) +  
  geom_text(aes(label = round(`Estimated hesitant or unsure`, 1)), 
            hjust = -0.1, size = 4) +  
  labs(title = "Figure 3. Top 10 Hesitant or Unsure Counties - Vaccine Hesitancy",
       x = "Hesitant or Unsure Percentage (%)",
       y = "County") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10),  # Adjust y-axis text size
        axis.text.x = element_text(size = 10),  # Adjust x-axis text size
        plot.title = element_text(hjust = 0.5))  # Center title

```

head(heatmap_data_hesitancy)
summary(heatmap_data_hesitancy$`Estimated hesitant`)

stuf




```{r}

## Appendix: Code Used for Project
#This section includes is all of the code I created in data cleaning and data wrangling to compile my report.

#Set Up Code
options(repos = c(CRAN = "https://cran.rstudio.com/"))
install.packages("knitr")
install.packages("readr")

library(knitr)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)

vaccine <- read_csv("~/Desktop/a7a4d868-f6d2-49c9-8a11-904c69a0e3a0.csv")

#Variables: ID, Disease, County, Year, Count

```

```{r}

# EDA

#Remove counties that reported 0 cases in a year
vaccine <- vaccine |> filter(Count != 0)

#Check count of disease categories in the dataset
vaccine |>
  count(Disease, sort=TRUE)

#Checked for any missing values or irregularities
#summary(vaccine)

#Total number of cases in dataset, stratify by counties, states overall, and top 5 diseases
county <- vaccine |> filter (County != 'California')
california <- vaccine |> filter (County == 'California')

#summations, each year
#table(vaccine$Year)
#sum(county$Count)

dim(county)
head(county)
tail(county)
str(county)
summary(county)
#No issues found in data irregularities. Year and Count variables numeric. Disease & County variables are character class. _id variable is irrelevant in this analysis.

```

```{r}
#Print Nice Table of Statistics

diseases_total <- county |> 
 group_by(Disease) |> 
 summarise(Total_Cases = sum(Count, na.rm = TRUE)) |> 
 arrange(desc(Total_Cases)) |> 
 slice_head(n = 15)
library (knitr)
kable(diseases_total, 
      col.names = c("Disease", "Total Cases"), 
     caption = "Total Cases of Vaccine-Preventable Diseases Reported in California, 2001-2022")

```
```{r}
 pertussis <- county |> filter (Disease == 'Pertussis')

 #Stratify Pertussis, Check Los Angeles Trend
pertussis_la <- pertussis |> 
  filter(County == 'Los Angeles')
library(dplyr)

# Aggregate total cases by year
annual_cases <- pertussis_la %>%
  group_by(Year) %>%
  summarise(Total_Cases = sum(Count, na.rm = TRUE))

library(ggplot2)

# Line graph for Total Cases per Year
ggplot(annual_cases, aes(x = Year, y = Total_Cases)) +
  geom_line(color = "darkgreen", size = 1.5) +
  geom_point(color = "darkgreen", size = 3) +
  labs(title = "Trend of Pertussis Cases in Los Angeles per Year",
       x = "Year",
       y = "Total Cases") +
  theme_minimal()


library(plotly)

# Line plot using ggplot
p <- ggplot(annual_cases, aes(x = Year, y = Total_Cases)) +
  geom_line(color = "darkgreen", size = 1.5) +
  geom_point(color = "darkgreen", size = 3) +
  labs(title = "Trend of Pertussis Cases in Los Angeles per Year",
       x = "Year",
       y = "Total Cases") +
  theme_minimal()

# Convert ggplot to interactive Plotly chart
ggplotly(p)

```

